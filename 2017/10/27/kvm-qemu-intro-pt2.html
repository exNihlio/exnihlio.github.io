<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Intro to KVM/QEMU and libvirt Part 2 | Your awesome title</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Intro to KVM/QEMU and libvirt Part 2" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Part II: Installation and creating a VM" />
<meta property="og:description" content="Part II: Installation and creating a VM" />
<link rel="canonical" href="/2017/10/27/kvm-qemu-intro-pt2.html" />
<meta property="og:url" content="/2017/10/27/kvm-qemu-intro-pt2.html" />
<meta property="og:site_name" content="Your awesome title" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-10-27T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Part II: Installation and creating a VM","@type":"BlogPosting","url":"/2017/10/27/kvm-qemu-intro-pt2.html","headline":"Intro to KVM/QEMU and libvirt Part 2","dateModified":"2017-10-27T00:00:00-06:00","datePublished":"2017-10-27T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/10/27/kvm-qemu-intro-pt2.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Your awesome title" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Your awesome title</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Intro to KVM/QEMU and libvirt Part 2</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-10-27T00:00:00-06:00" itemprop="datePublished">Oct 27, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Part II: Installation and creating a VM</p>

<ol>
  <li>Installation:</li>
</ol>

<p>This guide assumes you are using RHEL or CentOS 7, though the packages are available for Debian, Arch and Ubuntu. Consult your systems package manager for usage.</p>

<p>A 64bit CPU (AMD64) is generally required for a virtualization host, but this should only be a problem on very old CPUs.</p>

<p>The CPU also requires the Intel or AMD virtualization extensions, VT-d in the case of Intel CPUs or AMD-V for AMD CPUs. To see if your CPU is virtualization capable, run the following:</p>

<table>
  <tbody>
    <tr>
      <td>`[user@localhost - $]$ cat /proc/cpuinfo</td>
      <td>egrep “vmx</td>
      <td>svm</td>
      <td>lm”</td>
    </tr>
  </tbody>
</table>

<p>The lm value indicates that the CPU is virtualization capable. vmx are the Intel virtualization extensions and svm are the AMD virtualization extension.</p>

<p>If your system returns vmx or svm , and lm, your system is ready to be a virtualization host.</p>

<p>Make sure you have enabled virtualization inside the BIOS/UEFI as well. This is usually under advanced options. Check your motherboard documentation.</p>

<p>You will need the following packages installed, as well as their dependencies:</p>

<p><code class="highlighter-rouge">libvirt</code> <code class="highlighter-rouge">qemu-img</code> <code class="highlighter-rouge">qemu-kvm</code> <code class="highlighter-rouge">virt-install</code> <code class="highlighter-rouge">virt-manager</code> <code class="highlighter-rouge">virt-viewer</code></p>

<p>Run the following:</p>

<p><code class="highlighter-rouge">[user@localhost ~ ]$ sudo yum -y install libvirt qemu-img qemu-kvm virt-install  virt-manager virt-viewer</code></p>

<p>Start the libvirtd daemon:</p>

<p><code class="highlighter-rouge">[user@localhost ~ ]$ sudo systemctl start libvirtd</code></p>

<p>Enable the libvirtd daemon:</p>

<p><code class="highlighter-rouge">[user@localhost ~ ]$ sudo systemctl enable libvirtd</code></p>

<p>Verify that libvirtd is running:</p>

<p><code class="highlighter-rouge">[user@localhost ~ ]$ systemctl status libvirtd</code></p>

<p>You should see something similar to the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>● libvirtd.service - Virtualization daemon
Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)
Active: active (running) since Mon 2017-10-16 23:01:56 EDT; 1 weeks 3 days ago
</code></pre></div></div>

<p>You have now installed the required virtualization packages for running a VM under KVM/QEMU.</p>

<ol>
  <li>Creating Your First VM</li>
</ol>

<p>By default, most configurations, images, networks and file systems for KVM/QEMU are stored in the /var/lib/libvirt directory. These also have the necessary SELinux contexts to ensure proper functioning. This guide will assume use of these directories.</p>

<p>Download and obtain a CentOS or Fedora image. Ubuntu is currently not recommended using this procedure; there exists a bug in libvirt that causes some errors in installation.</p>

<p>I. Installation within bash</p>

<p>As previously discussed, virt-install is the default command-line installation utility for libvirt. There are number of options, flags and functions, but only a few are required.</p>

<p>To install a VM type the following:</p>

<p><code class="highlighter-rouge">[user@localhost ~ ]$ sudo virt-install --name example_VM --vcpus 1 --memory 1024 --location /var/lib/libvirt/images/CentOS7.iso --disk path=/var/lib/libvirt/filesystems/example_VM.img,size=20 --network network=default</code></p>

<p><code class="highlighter-rouge">--name</code> is self-explanatory. This is how the VM will be identified to the hypervisor.</p>

<p><code class="highlighter-rouge">--vcpus</code> refers to the number of virtual CPU threads given to the VM. To simplify, one vcpu equals one physical core, except for hyper-threaded CPUs. A four core physical CPU has four virtual CPUs to offer. A four core physical CPU with hyper-threading has 8 virtual CPUs to offer.</p>

<p><code class="highlighter-rouge">--memory</code> is how much RAM is provisioned for the machine. The VM will see itself as having 1GB of RAM available.</p>

<p><code class="highlighter-rouge">--location</code> refers to the physical location of the installation medium. This does not necessarily have to be ISO. A web server, FTP, or NFS server is also a valid source as well. If for some reason you receive an error during installation, the –cdrom option can be used in place of –location. Just make sure to still provide the path to the ISO.</p>

<p><code class="highlighter-rouge">--disk</code> describes the installation location of the VM. This will automatically create a virtual hard drive in the path listed, with a size of 20GB.</p>

<p>–network Networking in virtualized environments can rapidly become complex and confusing. By default, libvirt creates a virtual switch/bridge for your VMs, both for you host to connect to them, and to give networking to the VM. The default network name is default and assigns IP addresses in the 192.168.122.0/24 subnet.</p>

<p>Connections to and from your VM are automatically NATed through the hosts physical network adapter. By default, libvirt configures iptables to drop all incoming connections to your VMs through the NAT; that were not previously established by the VM itself.</p>

<p>After running the virt-install command, if everything went well, you should see something similar to the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting install...
Retrieving file vmlinuz...
Retrieving file initrd.img...
</code></pre></div></div>

<p>The virt-viewer window should pop up and you will see your system begin to boot. At this point, the OS can be installed like any other bare-metal system.</p>

  </div><a class="u-url" href="/2017/10/27/kvm-qemu-intro-pt2.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Your awesome title</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Your awesome title</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
